#!/bin/bash

#ARK4NES Script
# CHICHI de début de script
function print_box() {
  message="Génération des SD et ip du domaine : $1"
  width=${#message}
  horizontal_rule="+$(printf -- "-%.0s" $(seq 1 $width))+"
  empty_line="|$(printf -- " %.0s" $(seq 1 $width))|"

  echo "+$(printf -- "-%.0s" $(seq 1 $width))+"
  echo "|$(printf -- " %.0s" $(seq 1 $width))|"
  echo "| $message |"
  echo "| Script by ARK4NES|"
  echo "|$(printf -- " %.0s" $(seq 1 $width))|"
  echo "+$(printf -- "-%.0s" $(seq 1 $width))+"
}



# Function 1: Trouver des SD d'un domaine avc CRT.
function sousdomain() {
  echo "Debut phase 1"
  curl -s https://crt.sh/\?q\=$1\&output\=json | jq . | grep name | cut -d":" -f2 | grep -v "CN=" | cut -d'"' -f2 | awk '{gsub(/\\n/,"\n");}1;' | sort -u > ListSousDomaine.txt
  echo "Partie 1 traité (ListSousDomaine.txt)"
}

# Recuperation des ip des SD
function subdomainIpList() {
  for i in $(cat ListSousDomaine.txt);do host $i | grep "has address" | grep $1 | cut -d" " -f4 >> IP-SousDomaine.txt;done
  for i in $(cat ListSousDomaine.txt);do host $i | grep "has address" | grep $1 | cut -d" " -f1,4 >> IP_et_SousDomaine.txt;done

  echo "IPs sous domaine ok (IP-SousDomain.txt)"
}

# Recuperation d'info des SD Shodan
#function shodanInfo() {
#  echo "Debut des recherches shodan"
#  for i in $(cat IP-SousDomain.txt);do shodan host $i;done > ShodanInfo.txt
#  echo "Info Shodan ok (ShodanInfo.txt)"
  
#}

# Take user input
echo "Enter your domaine:"
read domaine

# Call functions
print_box $domaine
sousdomain $domaine
sleep 2
subdomainIpList $domaine
#sleep 2
#shodanInfo

echo "Fin du script"
